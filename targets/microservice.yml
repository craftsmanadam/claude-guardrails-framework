name: microservice
kind: target
sections:
  Microservices:
    - Prefer explicit service boundaries and ownership.
    - Require health checks and readiness probes.
    - Treat configuration as code; document env vars.
    - Follow 12-factor app principles.
    - "12-factor: Config via environment (no config in code)."
    - "12-factor: Stateless, disposable processes."
    - "12-factor: Logs as event streams (stdout/stderr)."
    - "12-factor: Strict build/release/run separation."
    - "12-factor: Backing services treated as attached resources."
    - Build acceptance tests from the composed container image.
    - Use test doubles for external dependencies (e.g., containerized SQL, mock OAuth2, mock API servers).
    - "Use URI path versioning: /v{major}/resource (e.g., /v1/users, /v2/users)."
    - "Use path versioning only for breaking changes; still follow SemVer for releases (minor/patch for non-breaking changes)."
    - "Breaking changes: removing fields, changing response structure, modifying required parameters, altering behavior."
    - "Non-breaking changes: adding optional fields, new endpoints, expanding enums; do not increment version."
    - Maintain latest major (N) and previous major (N-1) in production; deprecate older versions within 180 days unless policy states otherwise.
    - "Include deprecation warnings in response headers with RFC 1123 dates (example: Deprecation: true, Sunset: Wed, 11 Nov 2026 11:11:11 GMT)."
    - Document migration guides for each major version change.
    - "Default behavior: if no version specified, return 400 Bad Request."
    - For internal service-to-service APIs, prefer contract testing when consumer and provider are deployed together; otherwise use versioning.
    - Publish an OpenAPI/Swagger spec for every service.
    - Expose interactive API docs in non-production; in production, require auth-gating.
    - Version API docs alongside API versions.
